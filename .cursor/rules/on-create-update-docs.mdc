---
description: При создании нового — НЕПРЕМЕННО обновить документацию. Без исключений.
alwaysApply: true
---

# PlanRun — обновление документации при создании нового

## ⛔ ОБЯЗАТЕЛЬНОЕ ПРАВИЛО (без исключений)

**При создании любого нового элемента в проекте — в той же сессии, в том же коммите — дописать его в impact-matrix.mdc, architecture-flow.mdc и docs/.** Это выполняется **неприкословно**, без пропусков и отложений. Не «потом», не «если успею» — сразу.

Задача не считается выполненной, пока документация не обновлена.

---

## 1. Добавил новый метод в ApiClient

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — добавить строку в таблицу «Фронтенд: ApiClient»:
  ```
  | `методИмя` | Компонент1, Компонент2 (где вызывается) |
  ```
- `.cursor/rules/architecture-flow.mdc` — добавить в таблицу п.1 «Компонент/файл» вызов метода, если компонент уже есть; если нет — добавить строку.

---

## 2. Добавил новый компонент (React)

**Обновить:**
- `.cursor/rules/impact-matrix.mdc`:
  - В «Меняешь компонент» — добавить строку, кто использует новый компонент.
  - В «Обратный поиск» — добавить строку «Редактирую новый компонент → Затронет».
- `.cursor/rules/architecture-flow.mdc` — п.1 «Компонент/файл» (если компонент вызывает api); п.6 «Импорты компонентов» (кто импортирует новый компонент).
- `docs/01-FRONTEND.md` — добавить описание компонента.
- `docs/04-FILES-REFERENCE.md` — добавить строку в таблицу src/components.

**Если компонент вызывает api:** добавить в impact-matrix.mdc в таблицу «Меняешь метод» для каждого вызываемого api-метода — имя нового компонента.
**Если компонент импортирует другие:** добавить в architecture-flow п.6.

---

## 3. Добавил новый экран (screen)

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — useAuthStore «Проверить» (если экран использует api/store); добавить в «Обратный поиск».
- `.cursor/rules/architecture-flow.mdc` — п.1 таблица (компонент/файл, api-вызовы).
- `docs/01-FRONTEND.md` — добавить экран.
- `docs/04-FILES-REFERENCE.md` — добавить строку.
- `src/App.jsx` или `AppTabsContent.jsx` — маршрут (если нужен).

---

## 4. Добавил новый action в бэкенд (api_v2.php)

**Обновить:**
- `planrun-backend/api_v2.php` — case в switch.
- `src/api/ApiClient.js` — новый метод.
- `.cursor/rules/impact-matrix.mdc` — таблица «Меняешь метод» для нового ApiClient-метода; таблица «Бэкенд: Контроллеры».
- `.cursor/rules/architecture-flow.mdc` — п.5 «Бэкенд: контроллер → сервис».
- `docs/02-BACKEND.md` — описание контроллера/метода.
- `docs/03-API.md` — список action'ов.
- `openapi.yaml` — при необходимости.

---

## 5. Добавил новый метод в store (useAuthStore, usePlanStore, useWorkoutStore)

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — useAuthStore/usePlanStore/useWorkoutStore «Проверить» (если метод вызывается из компонентов — добавить их).
- `.cursor/rules/architecture-flow.mdc` — п.2 или п.3 (внутри store вызывает: добавить новый метод).
- `docs/01-FRONTEND.md` — добавить метод в описание store.

---

## 6. Добавил новую утилиту (utils, hooks, services)

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — таблица «Меняешь утилиту»; добавить строку и список вызывающих.
- `docs/01-FRONTEND.md` — описание утилиты.
- `docs/04-FILES-REFERENCE.md` — добавить файл.

---

## 7. Добавил новый контроллер/сервис в бэкенд

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — таблицы «Бэкенд: Контроллеры», «Бэкенд: Сервисы».
- `.cursor/rules/architecture-flow.mdc` — п.5 «Бэкенд: контроллер → сервис».
- `docs/02-BACKEND.md` — описание контроллера/сервиса.

---

## 8. Добавил новый импорт в компонент

**Обновить:**
- `.cursor/rules/impact-matrix.mdc` — добавить вызывающий компонент в «Проверить» для импортируемого (если это утилита, store, компонент).
- `.cursor/rules/architecture-flow.mdc` — п.6 «Импорты компонентов» (кто кого использует).

---

## Чек-лист при создании нового

- [ ] Добавил в impact-matrix.mdc (все релевантные таблицы)
- [ ] Добавил в architecture-flow.mdc (граф вызовов, цепочки)
- [ ] Обновил docs/01-FRONTEND.md или docs/02-BACKEND.md
- [ ] Обновил docs/04-FILES-REFERENCE.md
- [ ] При новом API: ApiClient, api_v2.php, openapi.yaml
