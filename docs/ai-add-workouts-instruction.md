# Инструкция для ИИ: как вносить тренировки в календарь

Документ описывает, как программа или ИИ-агент может добавлять, изменять и удалять запланированные тренировки в календаре пользователя (PlanRun). Используй его при генерации планов, ответах в чате или автоматическом заполнении календаря.

---

## 1. API и эндпоинты

Базовый URL: `POST /api_v2.php` с параметром `action` и телом запроса (JSON или form).

- **Добавить тренировку на дату:** `action=add_training_day_by_date`
- **Изменить тренировку:** `action=update_training_day`
- **Удалить тренировку:** `action=delete_training_day`

Запросы выполняются от имени авторизованного пользователя (сессия/cookies). Все даты — в формате **Y-m-d** (например, `2026-02-15`).

---

## 2. Добавление тренировки на дату

**Action:** `add_training_day_by_date`

**Тело запроса:**

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `date` | string (Y-m-d) | да | Дата дня, на который добавляется тренировка |
| `type` | string | да | Тип тренировки (см. список ниже) |
| `description` | string | нет | Текстовое описание (см. формат по типам) |
| `is_key_workout` | int (0/1) | нет | Ключевая тренировка (по умолчанию 0) |

**Пример:**

```json
{
  "date": "2026-02-15",
  "type": "easy",
  "description": "Лёгкий бег 8 км",
  "is_key_workout": 0
}
```

Ответ при успехе: `{ "success": true, "day_id": 123 }`. Неделя плана по дате создаётся автоматически, если её ещё нет.

---

## 3. Типы тренировок (type)

Допустимые значения `type`:

| type | Назначение |
|------|------------|
| `rest` | Отдых |
| `easy` | Лёгкий бег |
| `long` | Длительный бег |
| `tempo` | Темповый бег |
| `interval` | Интервальная тренировка |
| `fartlek` | Фартлек |
| `marathon` | Марофонский блок |
| `control` | Контрольная |
| `race` | Соревнование |
| `other` | ОФП (общая физическая подготовка) |
| `free` | Свободная |
| `sbu` | СБУ (специальные беговые упражнения) |

В интерфейсе: «Бег» → easy/long/tempo/interval/fartlek/race; «ОФП» → other; «СБУ» → sbu.

---

## 4. Формат описания (description) по типам

### 4.1 Бег (easy, tempo, long, race)

Произвольный текст или структурированная строка, например:

- `Лёгкий бег 8 км`
- `10 км, темп 5:30`
- `45 мин в лёгком темпе`
- `Разминка 2 км, 5×1 км (4:00), заминка 2 км`

Для интервалов и фартлека пользователь может использовать конструктор в модалке — описание тогда генерируется автоматически. ИИ может формировать аналогичный текст.

### 4.2 Интервалы (interval)

Удобный формат (как в конструкторе):

- Разминка: км, темп.
- Серия: количество повторов × дистанция (м), темп, отдых (м или время), тип отдыха (трусца/ходьба).
- Заминка: км, темп.

Пример:  
`Разминка 2 км. 5×1000 м (4:00), отдых 400 м трусцой. Заминка 2 км.`

### 4.3 Фартлек (fartlek)

Описание серий (ускорение + восстановление), при необходимости с дистанциями в метрах и темпом. Можно задать в свободной форме.

### 4.4 ОФП (other)

Строки вида **название упражнения — параметры**. Параметры:

- **подходы×повторения:** `3×10` (три подхода по 10 повторений);
- **вес (кг):** опционально, например `20 кг`;
- при необходимости длительность: `2 мин`.

Несколько упражнений — несколько строк (каждая с новой строки). В форме добавления/редактирования для каждого упражнения ОФП задаются поля: подходы, повторы, вес (кг).

**Пример:**

```
Приседания — 3×10, 20 кг
Выпрыгивания — 2×15
Планка — 1 мин
```

При внесении тренировки ИИ указывает в описании подходы×повторения и при необходимости вес в кг.

### 4.5 СБУ (sbu)

Аналогично ОФП: каждая строка — **название упражнения — дистанция в м (или км)**. По умолчанию в интерфейсе 30 м, но пользователь может задать своё значение (например, 50 м, 100 м). ИИ при создании/изменении тренировки указывает в описании нужную дистанцию.

**Пример:**

```
Бег с высоким подниманием бедра — 30 м
Захлёст голени — 50 м
Бег с подниманием колена — 30 м
```

---

## 5. Изменение тренировки

**Action:** `update_training_day`

**Тело запроса:**

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `day_id` | int | да | ID записи дня плана (из ответа добавления или из данных дня) |
| `type` | string | да | Тип (тот же список, что выше) |
| `description` | string | нет | Новое описание (можно не передавать — поле не очистится при пустой строке на бэкенде) |
| `is_key_workout` | int (0/1) | нет | Ключевая тренировка |

**Пример:**

```json
{
  "day_id": 123,
  "type": "sbu",
  "description": "Бег с высоким подниманием бедра — 50 м\nЗахлёст голени — 50 м",
  "is_key_workout": 0
}
```

---

## 6. Удаление тренировки

**Action:** `delete_training_day`

**Тело запроса:**

| Поле | Тип | Обязательное |
|------|-----|--------------|
| `day_id` | int | да |

**Пример:** `{ "day_id": 123 }`

---

## 7. Получение данных для контекста

- Чтобы узнать, что уже запланировано на дату, используется запрос дня: `get_day` с параметром даты. В ответе приходят плановые дни (`plan_days`), в каждом есть `id`, `type`, `description`, `date`, `is_key_workout`.
- Список упражнений из библиотеки (для подсказок по названиям ОФП/СБУ): `list_exercise_library` (GET). В ответе — `exercises` с полями `name`, `category`, `default_sets`, `default_reps`, `default_distance_m` и т.д.

---

## 8. Краткий чек-лист для ИИ

1. **Добавить тренировку:** вызвать `add_training_day_by_date` с `date`, `type`, при необходимости `description` и `is_key_workout`.
2. **Изменить:** вызвать `update_training_day` с `day_id`, `type`, при необходимости обновить `description` или `is_key_workout`.
3. **Удалить:** вызвать `delete_training_day` с `day_id`.
4. **ОФП и СБУ:** в `description` указывать дистанцию в формате `30 м` или `0.5 км` в каждой строке, если она нужна; пользователь в интерфейсе может потом изменить значение в поле «м» у каждого упражнения.
5. **Даты:** всегда в формате Y-m-d. Неделя плана создаётся по дате автоматически.

После любых изменений плана бэкенд инвалидирует кеш плана; фронт при следующем запросе дня/плана получит актуальные данные.
